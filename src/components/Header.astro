---
/**
 * Header Component
 *
 * Unified header with boxed and fullWidth variants.
 * Includes responsive navigation, theme toggle, and mobile menu.
 *
 * @example
 * ```astro
 * <Header />
 * <Header variant="fullWidth" />
 * ```
 */
import ThemeToggle from "./ThemeToggle.astro";
import Logo from "./Logo.astro";

interface Props {
  /** Layout variant - boxed (default) or fullWidth */
  variant?: 'boxed' | 'fullWidth';
}

const { variant = 'boxed' } = Astro.props;

const navItems = [
  { href: "/", label: "Home" },
  { href: "/solutions", label: "Solutions" },
  { href: "/projects", label: "Projects" },
  { href: "/blog", label: "Blog" },
  { href: "/about", label: "About" },
  { href: "/contact", label: "Contact" },
];

const containerClass = variant === 'fullWidth' 
  ? 'w-full px-4' 
  : 'container max-w-5xl mx-auto px-4 sm:px-6';
---

<header class="sticky top-0 z-50 w-full border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60">
  <div class:list={[containerClass, "flex h-14 items-center justify-between"]}>
    <!-- Logo -->
    <div class="flex">
      <Logo />
    </div>

    <!-- Desktop Navigation (hidden on mobile) -->
    <nav class="hidden md:flex items-center gap-6 text-sm">
      {navItems.map((item) => (
        <a
          href={item.href}
          class="transition-colors hover:text-foreground/80 text-foreground/60"
        >
          {item.label}
        </a>
      ))}
    </nav>

    <div class="hidden md:flex items-center space-x-2">
      <ThemeToggle />
    </div>

    <!-- Mobile Actions (visible on mobile) -->
    <div class="flex md:hidden items-center space-x-2">
      <ThemeToggle />
      <button
        id="mobile-menu-button"
        class="inline-flex items-center justify-center rounded-md p-2 hover:bg-accent hover:text-accent-foreground focus:outline-none focus:ring-2 focus:ring-inset focus:ring-primary"
        aria-expanded="false"
        aria-label="Toggle navigation menu"
      >
        <div class="w-6 h-6 relative flex flex-col justify-center items-center">
          <span id="hamburger-top" class="block w-5 h-0.5 bg-current transform transition-all duration-300 absolute -translate-y-1.5"></span>
          <span id="hamburger-middle" class="block w-5 h-0.5 bg-current transform transition-all duration-300"></span>
          <span id="hamburger-bottom" class="block w-5 h-0.5 bg-current transform transition-all duration-300 absolute translate-y-1.5"></span>
        </div>
      </button>
    </div>
  </div>

  <!-- Mobile Menu (hidden by default) -->
  <div id="mobile-menu" class="hidden md:hidden border-t">
    <div class:list={[variant === 'fullWidth' ? 'px-4' : 'container max-w-5xl mx-auto px-4', "py-4 space-y-3"]}>
      {navItems.map((item) => (
        <a
          href={item.href}
          class="block px-3 py-2 rounded-md text-base font-medium hover:bg-accent hover:text-accent-foreground transition-colors"
        >
          {item.label}
        </a>
      ))}
    </div>
  </div>
</header>

<script>
  function initMobileMenu() {
    const menuButton = document.getElementById('mobile-menu-button');
    const mobileMenu = document.getElementById('mobile-menu');
    const hamburgerTop = document.getElementById('hamburger-top');
    const hamburgerMiddle = document.getElementById('hamburger-middle');
    const hamburgerBottom = document.getElementById('hamburger-bottom');

    function toggleHamburger(isOpen: boolean) {
      if (isOpen) {
        hamburgerTop?.classList.add('rotate-45', 'translate-y-0');
        hamburgerTop?.classList.remove('-translate-y-1.5');
        hamburgerMiddle?.classList.add('opacity-0', 'scale-0');
        hamburgerBottom?.classList.add('-rotate-45', 'translate-y-0');
        hamburgerBottom?.classList.remove('translate-y-1.5');
      } else {
        hamburgerTop?.classList.remove('rotate-45', 'translate-y-0');
        hamburgerTop?.classList.add('-translate-y-1.5');
        hamburgerMiddle?.classList.remove('opacity-0', 'scale-0');
        hamburgerBottom?.classList.remove('-rotate-45', 'translate-y-0');
        hamburgerBottom?.classList.add('translate-y-1.5');
      }
    }

    menuButton?.addEventListener('click', () => {
      const isExpanded = menuButton.getAttribute('aria-expanded') === 'true';
      mobileMenu?.classList.toggle('hidden');
      toggleHamburger(!isExpanded);
      menuButton.setAttribute('aria-expanded', String(!isExpanded));
    });

    const mobileMenuLinks = mobileMenu?.querySelectorAll('a');
    mobileMenuLinks?.forEach(link => {
      link.addEventListener('click', () => {
        mobileMenu?.classList.add('hidden');
        toggleHamburger(false);
        menuButton?.setAttribute('aria-expanded', 'false');
      });
    });
  }

  // Run on initial load and after view transitions
  initMobileMenu();
  document.addEventListener('astro:after-swap', initMobileMenu);
</script>
