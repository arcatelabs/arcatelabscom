---
import BaseLayout from "@/layouts/BaseLayout.astro";
import directus from "@/lib/directus";
import { readItems } from "@directus/sdk";

export async function getStaticPaths() {
  let pages: any[] = [];
  try {
    pages = await directus.request(
      readItems("pages", {
        filter: { status: { _eq: "published" } },
        fields: ["slug", "title", "content", "seo_title", "seo_description"],
      })
    );
  } catch {
    // Collection empty or doesn't exist
  }

  return pages.map((page: any) => ({
    params: { slug: page.slug },
    props: { page },
  }));
}

const { page } = Astro.props;
---

<BaseLayout
  title={page.seo_title || page.title}
  description={page.seo_description || ""}
>
  <div class="container max-w-5xl mx-auto py-20 px-4 sm:px-6">
    <h1 class="text-5xl font-bold tracking-tight md:text-7xl mb-12">{page.title}</h1>
    {page.content && (
      <div class="prose prose-lg max-w-none dark:prose-invert" set:html={page.content} />
    )}
  </div>
</BaseLayout>
