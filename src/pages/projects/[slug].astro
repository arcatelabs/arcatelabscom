---
import BaseLayout from "@/layouts/BaseLayout.astro";
import directus, { getAssetUrl } from "@/lib/directus";
import { readItems } from "@directus/sdk";

export async function getStaticPaths() {
  let projects: any[] = [];
  try {
    projects = await directus.request(
      readItems("projects", {
        filter: { status: { _eq: "published" } },
      })
    );
  } catch {
    return [];
  }

  return projects.map((project: any) => ({
    params: { slug: project.slug },
    props: { project },
  }));
}

const { project } = Astro.props;
---

<BaseLayout title={project.title} description={project.summary || `${project.title} - Arcate Labs`}>
  <div class="container max-w-4xl mx-auto py-20 px-4 sm:px-6">
    <a href="/projects" class="text-sm text-muted-foreground hover:text-foreground transition-colors mb-8 inline-block">&larr; All Projects</a>
    {project.client && (
      <p class="text-sm font-semibold text-primary uppercase tracking-wide mb-2">{project.client}</p>
    )}
    <h1 class="text-5xl font-bold tracking-tight mb-6">{project.title}</h1>
    {project.summary && (
      <p class="text-xl text-muted-foreground mb-12">{project.summary}</p>
    )}
    {project.image && (
      <img src={getAssetUrl(project.image)} alt={project.title} class="rounded-lg mb-12 w-full" />
    )}
    {project.content && (
      <div class="prose prose-lg max-w-none dark:prose-invert" set:html={project.content} />
    )}
    {project.url && (
      <a href={project.url} target="_blank" rel="noopener noreferrer" class="inline-flex items-center gap-2 mt-8 rounded-md bg-primary text-primary-foreground hover:bg-primary/90 h-11 px-8 text-sm font-medium">
        Visit Project
        <svg class="h-3 w-3" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14"/></svg>
      </a>
    )}
  </div>
</BaseLayout>
