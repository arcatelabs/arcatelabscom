---
import BaseLayout from "@/layouts/BaseLayout.astro";
import directus from "@/lib/directus";
import { readItems } from "@directus/sdk";

let posts: any[] = [];
try {
  posts = await directus.request(
    readItems("posts", {
      filter: { status: { _eq: "published" } },
      sort: ["-date_published"],
    })
  );
} catch {
  // No posts yet
}

function formatDate(date: string) {
  return new Date(date).toLocaleDateString("en-US", {
    year: "numeric",
    month: "long",
    day: "numeric",
  });
}
---

<BaseLayout title="Blog" description="Thoughts, insights, and updates from Arcate Labs.">
  <div class="container max-w-4xl mx-auto py-20 px-4 sm:px-6">
    <div class="mb-20">
      <h1 class="text-5xl font-bold tracking-tight md:text-7xl mb-8">Blog</h1>
      <p class="text-xl text-muted-foreground">
        Thoughts, insights, and updates from the team.
      </p>
    </div>

    {posts.length > 0 ? (
      <div class="space-y-8">
        {posts.map((post: any, index: number) => (
          <article class="group">
            <a href={`/blog/${post.slug}`} class="flex items-center justify-between gap-8 -mx-6 px-6 py-4 rounded-lg transition-colors hover:bg-accent/50">
              <div class="flex-1">
                <h2 class="text-2xl font-bold tracking-tight group-hover:text-primary transition-colors md:text-4xl">
                  {post.title}
                </h2>
                {post.excerpt && (
                  <p class="mt-2 text-muted-foreground text-sm md:text-base">{post.excerpt}</p>
                )}
              </div>
              {post.date_published && (
                <time datetime={post.date_published} class="text-sm text-muted-foreground whitespace-nowrap">
                  {formatDate(post.date_published)}
                </time>
              )}
            </a>
            {index < posts.length - 1 && (
              <div class="mt-8 border-b border-border"></div>
            )}
          </article>
        ))}
      </div>
    ) : (
      <div class="rounded-lg border bg-muted/50 p-12 text-center">
        <p class="text-muted-foreground">No posts yet. Check back soon.</p>
      </div>
    )}
  </div>
</BaseLayout>
