---
import BaseLayout from "@/layouts/BaseLayout.astro";
import TechStack from "@/components/sections/TechStack.astro";
import directus, { getAssetUrl } from "@/lib/directus";
import { readSingleton, readItems } from "@directus/sdk";

let aboutPage: any = null;
try {
  aboutPage = await directus.request(readSingleton("about_page"));
} catch {
  // Collection empty or doesn't exist — use defaults
}

let teamMembers: any[] = [];
try {
  teamMembers = await directus.request(
    readItems("team_members", {
      filter: { status: { _eq: "published" } },
      sort: ["sort"],
    })
  );
} catch {
  // No team members yet
}
---

<BaseLayout title="About" description="About Arcate Labs - automated demand systems built for scale.">
  <div class="container max-w-5xl mx-auto py-20 px-4 sm:px-6">
    <div class="mb-16">
      <h1 class="text-5xl font-bold tracking-tight md:text-7xl">{aboutPage?.title ?? "About"}</h1>
    </div>

    {aboutPage?.content ? (
      <div class="prose prose-lg max-w-none dark:prose-invert mb-20" set:html={aboutPage.content} />
    ) : (
      <div class="space-y-6 text-lg text-muted-foreground leading-relaxed mb-20 max-w-3xl">
        <p>
          Arcate Labs designs and operates automated demand systems that turn search intent into real business outcomes.
        </p>
        <p>
          Every day, people look for someone to fix a problem, provide a service, or offer care. At the same time, many businesses struggle to be found — not because they lack skill, but because the systems connecting them to customers are complicated or unreliable.
        </p>
        <p>
          We approach our work with the understanding that technology should support people, not ask them to reorganize their lives around it. Instead of managing ongoing marketing or short-term campaigns, we focus on creating structures that help the right connections happen without constant manual effort.
        </p>
        <p>
          We focus on building things that last, designing with scale in mind from the beginning, and reducing the amount of ongoing effort required to keep things running.
        </p>
      </div>
    )}

    {teamMembers.length > 0 && (
      <div>
        <h2 class="text-3xl font-bold mb-8">{aboutPage?.team_section_title ?? "The Team"}</h2>
        <div class="grid gap-8 sm:grid-cols-2 md:grid-cols-3">
          {teamMembers.map((member: any) => (
            <div class="rounded-lg border bg-card p-6 text-center">
              {member.photo ? (
                <img src={getAssetUrl(member.photo)} alt={member.name} class="w-24 h-24 rounded-full mx-auto mb-4 object-cover" />
              ) : (
                <div class="w-24 h-24 rounded-full mx-auto mb-4 bg-muted flex items-center justify-center">
                  <span class="text-2xl font-bold text-muted-foreground">{member.name.charAt(0)}</span>
                </div>
              )}
              <h3 class="font-bold">{member.name}</h3>
              {member.role && (
                <p class="text-sm text-muted-foreground">{member.role}</p>
              )}
              {member.bio && (
                <p class="mt-3 text-sm text-muted-foreground">{member.bio}</p>
              )}
              {member.linkedin && (
                <a href={member.linkedin} target="_blank" rel="noopener noreferrer" class="text-sm text-primary hover:underline mt-2 inline-block">LinkedIn</a>
              )}
            </div>
          ))}
        </div>
      </div>
    )}
  </div>

  <div id="stack">
    <TechStack
      title="Our Full Tech Stack"
      subtitle="The tools and platforms we use to deliver results across every engagement."
    />
  </div>
</BaseLayout>
