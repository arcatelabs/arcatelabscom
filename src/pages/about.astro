---
import BaseLayout from "@/layouts/BaseLayout.astro";
import TechStack from "@/components/sections/TechStack.astro";
import directus, { getAssetUrl } from "@/lib/directus";
import { readSingleton, readItems } from "@directus/sdk";

let aboutPage: any = null;
try {
  aboutPage = await directus.request(readSingleton("about_page"));
} catch {
  // Collection empty or doesn't exist — use defaults
}

let teamMembers: any[] = [];
try {
  teamMembers = await directus.request(
    readItems("team_members", {
      filter: { status: { _eq: "published" } },
      sort: ["sort"],
    })
  );
} catch {
  // No team members yet
}
---

<BaseLayout title="About" description="An automation-first development studio based in Wisconsin. We build systems that connect your tools, generate your leads, and handle the work your team shouldn't be doing manually.">
  <div class="container max-w-5xl mx-auto py-20 px-4 sm:px-6">
    <div class="mb-16">
      <h1 class="text-5xl font-bold tracking-tight md:text-7xl">{aboutPage?.title ?? "About Arcate Labs"}</h1>
    </div>

    {aboutPage?.content ? (
      <div class="prose prose-lg max-w-none dark:prose-invert mb-20" set:html={aboutPage.content} />
    ) : (
      <>
        <!-- The Story -->
        <div class="space-y-6 text-lg text-muted-foreground leading-relaxed max-w-3xl mb-20">
          <h2 class="text-2xl font-bold text-foreground">The Story</h2>
          <p>
            Arcate Labs started with a simple observation: most of the work in digital marketing shouldn't be manual.
          </p>
          <p>
            We were building SEO sites and spending half our time on things that had nothing to do with strategy or creativity — moving data between systems, formatting content, building the same page structures over and over, compiling reports. So we started automating it.
          </p>
          <p>
            First it was our own workflows. Then it was the entire site-building process. Then clients started asking if we could automate their stuff too.
          </p>
          <p>
            Now we're a development studio that builds automation systems across industries — with SEO as our sharpest vertical. We're based in Wisconsin, we work remotely, and we build things that run themselves.
          </p>
        </div>

        <!-- What We Believe -->
        <div class="mb-20">
          <h2 class="text-2xl font-bold mb-8">What We Believe</h2>
          <div class="grid gap-6 md:grid-cols-3">
            <div class="rounded-lg border bg-card p-6">
              <h3 class="font-bold mb-2">Build systems, not dependency.</h3>
              <p class="text-sm text-muted-foreground">Our goal is to give you something that works without us. If you need us forever, we built it wrong.</p>
            </div>
            <div class="rounded-lg border bg-card p-6">
              <h3 class="font-bold mb-2">Automate the boring parts.</h3>
              <p class="text-sm text-muted-foreground">Humans should do creative, strategic, judgment-heavy work. Machines should do everything else.</p>
            </div>
            <div class="rounded-lg border bg-card p-6">
              <h3 class="font-bold mb-2">Ship, then improve.</h3>
              <p class="text-sm text-muted-foreground">A working system today beats a perfect plan next quarter.</p>
            </div>
          </div>
          <div class="md:col-span-3 mt-6">
            <blockquote class="border-l-4 border-primary pl-6 py-4">
              <p class="text-lg font-medium italic text-foreground mb-2">
                "Without data, you're just another person with an opinion."
              </p>
              <footer class="text-muted-foreground">
                — W. Edwards Deming
              </footer>
              <a href="/blog/without-data" class="text-sm font-medium text-primary hover:underline mt-2 inline-block">
                This quote shaped how we build everything &rarr;
              </a>
            </blockquote>
          </div>
        </div>
      </>
    )}

    {teamMembers.length > 0 && (
      <div class="mb-20">
        <h2 class="text-3xl font-bold mb-8">{aboutPage?.team_section_title ?? "The Team"}</h2>
        <div class="grid gap-8 sm:grid-cols-2 md:grid-cols-3">
          {teamMembers.map((member: any) => (
            <div class="rounded-lg border bg-card p-6 text-center">
              {member.photo ? (
                <img src={getAssetUrl(member.photo)} alt={member.name} class="w-24 h-24 rounded-full mx-auto mb-4 object-cover" />
              ) : (
                <div class="w-24 h-24 rounded-full mx-auto mb-4 bg-muted flex items-center justify-center">
                  <span class="text-2xl font-bold text-muted-foreground">{member.name.charAt(0)}</span>
                </div>
              )}
              <h3 class="font-bold">{member.name}</h3>
              {member.role && (
                <p class="text-sm text-muted-foreground">{member.role}</p>
              )}
              {member.bio && (
                <p class="mt-3 text-sm text-muted-foreground">{member.bio}</p>
              )}
              {member.linkedin && (
                <a href={member.linkedin} target="_blank" rel="noopener noreferrer" class="text-sm text-primary hover:underline mt-2 inline-block">LinkedIn</a>
              )}
            </div>
          ))}
        </div>
      </div>
    )}
  </div>

  <div id="stack">
    <TechStack
      title="Our Stack"
      subtitle="The tools and platforms we use to build and deliver automation systems."
    />
  </div>
</BaseLayout>
